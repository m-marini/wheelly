---
$schema: https://json-schema.org/draft/2020-12/schema
$id: https://mmarini.org/wheelly/agent-schema
title: Agent
type: object
properties:
  version:
    const: "0.4"
  active:
    type: string
  configurations:
    type: object
    additionalProperties:
      $ref: "#/$defs/AgentSet"
required:
  - version
  - active
  - configurations
$defs:
  InputProcessor:
    anyOf:
      - $ref: "#/$defs/AndProcessor"
      - $ref: "#/$defs/NotProcessor"
      - $ref: "#/$defs/MaskedTilesVectorProcessor"
      - $ref: "#/$defs/TilesProcessor"
      - $ref: "#/$defs/PartitionProcessor"
      - $ref: "#/$defs/FeatureVectorProcessor"
  FeatureVectorProcessor:
    type: object
    properties:
      class:
        const: org.mmarini.rl.processors.FeatureVectorProcessor
      name:
        minLenght: 1
      inputs:
        type: array
        items:
          type: string
    required:
      - class
      - name
      - inputs
  MaskedTilesVectorProcessor:
    type: object
    properties:
      class:
        const: org.mmarini.rl.processors.MaskedTilesVectorProcessor
      name:
        minLenght: 1
      input:
        minLenght: 1
      mask:
        minLenght: 1
      numTiles:
        multipleOf: 1
        minimum: 1
    required:
      - class
      - name
      - input
      - mask
      - numTiles
  TilesProcessor:
    type: object
    properties:
      class:
        const: org.mmarini.rl.processors.TilesProcessor
      name:
        minLenght: 1
      inputs:
        type: array
        items:
          type: object
          properties:
            name:
              minLenght: 1
            numTiles:
              multipleOf: 1
              minimum: 1
          required:
            - name
            - numTiles
    required:
      - class
      - name
      - inputs
  NotProcessor:
    type: object
    properties:
      class:
        const: org.mmarini.rl.processors.NotProcessor
      name:
        minLenght: 1
      input:
        minLenght: 1
    required:
      - class
      - name
      - input
  AndProcessor:
    type: object
    properties:
      class:
        const: org.mmarini.rl.processors.AndProcessor
      name:
        minLenght: 1
      inputs:
        type: array
        items:
          type: string
    required:
      - class
      - name
      - inputs
  PartitionProcessor:
    type: object
    properties:
      class:
        const: org.mmarini.rl.processors.PartitionProcessor
      name:
        minLenght: 1
      inputs:
        type: array
        items:
          type: object
          properties:
            name:
              minLenght: 1
            numTiles:
              multipleOf: 1
              minimum: 1
          required:
            - name
            - numTiles
    required:
      - class
      - name
      - inputs
  InputProcessors:
    type: array
    items:
      $ref: "#/$defs/InputProcessor"
    minItems: 1
  Composer:
    type: object
    properties:
      type:
        enum: [ sum, concat ]
      inputs:
        type: array
        items:
          type: string
    required:
      - type
      - inputs
  Layer:
    anyOf:
      - $ref: "#/$defs/Linear"
      - $ref: "#/$defs/Dense"
      - $ref: "#/$defs/DropOut"
      - $ref: "#/$defs/Softmax"
      - $ref: "#/$defs/Others"
  Others:
    type: object
    properties:
      type:
        enum:
          - relu
          - tanh
    required:
      - type
  Dense:
    type: object
    properties:
      type:
        const: dense
      outputSize:
        multipleOf: 1
        minimum: 1
      maxAbsWeights:
        exclusiveMinimum: 0
      dropOut:
        exclusiveMinimum: 0
        maximum: 1
    required:
      - type
      - outputSize
  DropOut:
    type: object
    properties:
      type:
        const: dropout
      dropOut:
        exclusiveMinimum: 0
        maximum: 1
    required:
      - type
      - dropOut
  Softmax:
    type: object
    properties:
      type:
        const: softmax
      temperature:
        exclusiveMinimum: 0
    required:
      - type
      - temperature
  Linear:
    type: object
    properties:
      type:
        const: linear
      b:
        type: number
      w:
        type: number
    required:
      - type
      - b
      - w
  Layers:
    type: object
    properties:
      input:
        type: string
      inputs:
        $ref: "#/$defs/Composer"
      layers:
        type: array
        items:
          $ref: "#/$defs/Layer"
    required:
      - layers
  Network:
    type: object
    additionalProperties:
      $ref: "#/$defs/Layers"
  AgentSet:
    type: object
    properties:
      class:
        const: org.mmarini.rl.agents.TDAgent
      version:
        const: "0.1"
      modelPath:
        minLength: 1
      savingIntervalSteps:
        multipleOf: 1
        minimum: 1
      seed:
        multipleOf: 1
        minimum: 1
      rewardAlpha:
        exclusiveMinimum: 0
      policyAlpha:
        exclusiveMinimum: 0
      criticAlpha:
        exclusiveMinimum: 0
      lambda:
        minimum: 0
      inputProcess:
        $ref: "#/$defs/InputProcessors"
      policy:
        $ref: "#/$defs/Network"
      critic:
        $ref: "#/$defs/Network"
    required:
      - class
      - version
      - modelPath
      - rewardAlpha
      - policyAlpha
      - criticAlpha
      - lambda
      - policy
      - critic
