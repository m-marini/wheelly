---
version: "0.2"
active: tilesAgent

configurations:
  randomAgent:
    class: org.mmarini.wheelly.agents.RandomAgent
    seed: 1234
  constantAgent:
    class: org.mmarini.wheelly.agents.ConstantAgent
    actions:
      halt: 0
      direction: 15
      sensorAction: 3
      speed: 8
  ######################################
  # Base agent
  ######################################
  baseAgent:
    class: org.mmarini.wheelly.agents.TDAgent
    seed: 1234
    modelPath: models/baseAgent
    savingIntervalSteps: 1000
    rewardAlpha: 5e-3
    policyAlpha: 100e-3
    criticAlpha: 100e-3
    lambda: 0
    policy:
      sensorNorm:
        input: sensor
        layers:
          - type: linear
            b: 0
            w: 11.111111e-3
      distanceNorm:
        input: distance
        layers:
          - type: linear
            b: 0
            w: 333.33333e-3
      contactsNorm:
        input: contacts
        layers:
          - type: linear
            b: 0
            w: 62.4e-3
      layer0:
        inputs:
          type: concat
          inputs:
            - sensorNorm
            - distanceNorm
            - canMoveForward
            - canMoveBackward
            - contactsNorm
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      hidden0:
        input: layer0
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      hidden1:
        inputs:
          type: sum
          inputs:
            - layer0
            - hidden0
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      hidden2:
        inputs:
          type: sum
          inputs:
            - hidden0
            - hidden1
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      halt:
        input: hidden2
        layers:
          - type: dense
            outputSize: 2
          - type: tanh
          - type: softmax
            temperature: 0.6
      direction:
        input: hidden2
        layers:
          - type: dense
            outputSize: 25
          - type: tanh
          - type: softmax
            temperature: 0.6
      speed:
        input: hidden2
        layers:
          - type: dense
            outputSize: 9
          - type: tanh
          - type: softmax
            temperature: 0.6
      sensorAction:
        input: hidden2
        layers:
          - type: dense
            outputSize: 7
          - type: tanh
          - type: softmax
            temperature: 0.6
    critic:
      sensorNorm:
        input: sensor
        layers:
          - type: linear
            b: 0
            w: 11.111111e-3
      distanceNorm:
        input: distance
        layers:
          - type: linear
            b: 0
            w: 333.33333e-3
      contactsNorm:
        input: contacts
        layers:
          - type: linear
            b: 0
            w: 62.4e-3
      layer0:
        inputs:
          type: concat
          inputs:
            - sensorNorm
            - distanceNorm
            - canMoveForward
            - canMoveBackward
            - contactsNorm
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      hidden0:
        input: layer0
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      hidden1:
        inputs:
          type: sum
          inputs:
            - layer0
            - hidden0
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      hidden2:
        inputs:
          type: sum
          inputs:
            - hidden0
            - hidden1
        layers:
          - type: dense
            outputSize: 300
          - type: relu
      output:
        input: hidden2
        layers:
          - type: dense
            outputSize: 1
          - type: tanh
######################################
# Tiles agent
######################################
  tilesAgent:
    class: org.mmarini.wheelly.agents.TDAgent
    seed: 1234
    modelPath: models/tilesAgent
    savingIntervalSteps: 1000
    rewardAlpha: 5e-3
    policyAlpha: 100e-3
    criticAlpha: 100e-3
    lambda: 0
    inputProcess:
      - name: tiles
        class: org.mmarini.wheelly.agents.TilesProcessor
        inputs:
          sensor: 7
          distance: 30
    policy:
      layer0:
        inputs:
          type: concat
          inputs:
            - tiles
            - canMoveForward
            - canMoveBackward
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      hidden0:
        input: layer0
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      hidden1:
        inputs:
          type: sum
          inputs:
            - layer0
            - hidden0
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      hidden2:
        inputs:
          type: sum
          inputs:
            - hidden0
            - hidden1
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      halt:
        input: hidden2
        layers:
          - type: dense
            outputSize: 2
          - type: tanh
          - type: softmax
            temperature: 0.6
      direction:
        input: hidden2
        layers:
          - type: dense
            outputSize: 25
          - type: tanh
          - type: softmax
            temperature: 0.6
      speed:
        input: hidden2
        layers:
          - type: dense
            outputSize: 9
          - type: tanh
          - type: softmax
            temperature: 0.6
      sensorAction:
        input: hidden2
        layers:
          - type: dense
            outputSize: 7
          - type: tanh
          - type: softmax
            temperature: 0.6
    critic:
      layer0:
        inputs:
          type: concat
          inputs:
            - tiles
            - canMoveForward
            - canMoveBackward
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      hidden0:
        input: layer0
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      hidden1:
        inputs:
          type: sum
          inputs:
            - layer0
            - hidden0
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      hidden2:
        inputs:
          type: sum
          inputs:
            - hidden0
            - hidden1
        layers:
          - type: dense
            outputSize: 100
          - type: relu
      output:
        input: hidden2
        layers:
          - type: dense
            outputSize: 1
          - type: tanh
